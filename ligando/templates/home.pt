<!DOCTYPE html>
<html metal:use-macro="load: base_layout.pt">
<html lang="${request.locale_name}">
<head>

</head>

<body>
<div class="main_wrapper">
<div id="statistic_wrapper" class="wrapper" >

        <div id="search_div" style="text-align: center">
            <form method="POST" action=search>
                       <!--? this js magic shows a help text, which will disappear on focus-->
                <input style="width: 500px" name="search_all" value="Search Database" onfocus="if (this.value=='Search Database') this.value='';" onblur="this.value = this.value==''?'Search Database':this.value;" >
                <input  type="submit" value="Search" class="nice_button" style="width: 100px;margin-left: 10px"/>
            </form>
        </div>
    <br><br>
        <div  style="float:left; width: 330px">
        <h3>Database Statistics</h3>
        Sources: <a class='nostylelink'  href='/sources'>${sources_count}</a><br>
        Ms Runs: <a class='nostylelink'  href='/runs'>${all_msrun_count}</a><br>
        Orphan Ms Runs: ${orphan_msrun_count}
        </div>

        <div id="msrun_plot" style="width:300px;height:330px; display: inline-block;"></div>


            <div class="homegrid" style="float:right; width: 330px ">
        <table id="orphan_table">
        </table>
                </div>

</div>
</div>

<!--?import the  Flot js file-->
<script type="text/javascript" charset="utf8" src="${request.static_url('ligando:static/js/jquery.flot.js')}"></script>



<script>
    $(function() {
        // set the statistics
        var ms_run = [[1,${all_msrun_count}]];
        var orphan_ms_run = [[2,200]]; //${orphan_msrun_count}]];

        // create data for the flot plot
        var data = [{label: 'Complete MS Runs', data:ms_run,color: "rgb("+180+","+160+","+105+")"},
                {label: 'Orphan MS Runs', data:orphan_ms_run, color: "rgb("+165+","+30+","+55+")"}]
        // flot options
        var options = {series: {
                stack: 0,

                 lines: {
                     show: false,
                     steps: false },
                 bars: {
                     show: true,
                     barWidth: 0.5,
                     align: 'center',
                     fill :1,
                     clickable:true}
                },
                xaxis: {
                    min: 0,
                    max:3,
                    show:false
                },
                grid: {
                    clickable: true,
                    hover: true
        }
    };
    // plot the ms runs statistics
    $.plot("#msrun_plot",data,options);
    });
    // allows clickable bars in the plot
    $("#msrun_plot").bind("plotclick", function (event, pos, item) {
        if(item) {
            if(item["seriesIndex"]==0){
                window.location.href = "/runs";
            }else{
                window.location.href = "/orphan_runs";
            }
        }
        });

    // create the orphan table
    $(function () {
        var table = document.getElementById('orphan_table');
        var markup = ['<thead> <tr><th>Orphan Ms Runs</th></tr>  </thead><tbody>'];

        for (var i = 0; i < 10; i++) {
            if (i % 2 != 0) {
                markup.push('<tr class="alt">');
            } else {
                markup.push('<tr >');
            }
            markup.push('<td>')
            var run = ${orphan_msrun}[i]
            markup.push('<a class="nostylelink" href="/upload_metadata_ms_run?run='+ run + '">'+run+ '</a></td></tr>')
        }
        markup.push('</tbody>');
        table.innerHTML = markup.join("");
    });


</script>


</body>
</html>